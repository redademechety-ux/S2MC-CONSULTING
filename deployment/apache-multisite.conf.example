# Configuration Apache pour hébergement multisite
# S2MC Consulting Website

# Site Principal - s2mc-consulting.com
<VirtualHost *:80>
    ServerName s2mc-consulting.com
    ServerAlias www.s2mc-consulting.com
    
    DocumentRoot /var/www/s2mc-consulting/build
    
    <Directory /var/www/s2mc-consulting/build>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # React Router - Important pour SPA
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
    
    # Compression GZIP
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml
        AddOutputFilterByType DEFLATE text/css text/javascript
        AddOutputFilterByType DEFLATE application/javascript application/json
        AddOutputFilterByType DEFLATE application/xml application/xhtml+xml
    </IfModule>
    
    # Cache navigateur
    <IfModule mod_expires.c>
        ExpiresActive On
        
        # Images
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/webp "access plus 1 year"
        ExpiresByType image/svg+xml "access plus 1 year"
        ExpiresByType image/x-icon "access plus 1 year"
        
        # CSS et JavaScript
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType text/javascript "access plus 1 month"
        
        # Fonts
        ExpiresByType font/ttf "access plus 1 year"
        ExpiresByType font/otf "access plus 1 year"
        ExpiresByType font/woff "access plus 1 year"
        ExpiresByType font/woff2 "access plus 1 year"
        ExpiresByType application/font-woff "access plus 1 year"
        
        # HTML par défaut
        ExpiresByType text/html "access plus 0 seconds"
    </IfModule>
    
    # En-têtes de sécurité
    <IfModule mod_headers.c>
        Header set X-Content-Type-Options "nosniff"
        Header set X-Frame-Options "SAMEORIGIN"
        Header set X-XSS-Protection "1; mode=block"
        Header set Referrer-Policy "strict-origin-when-cross-origin"
        
        # Cache Control pour fichiers statiques
        <FilesMatch "\.(ico|jpg|jpeg|png|gif|svg|webp|js|css|woff|woff2|ttf|otf)$">
            Header set Cache-Control "max-age=31536000, public, immutable"
        </FilesMatch>
    </IfModule>
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/s2mc-consulting-error.log
    CustomLog ${APACHE_LOG_DIR}/s2mc-consulting-access.log combined
</VirtualHost>

# Configuration SSL (Let's Encrypt ajoutera automatiquement la section :443)
# Ou copiez cette section et remplacez les chemins des certificats

#<VirtualHost *:443>
#    ServerName s2mc-consulting.com
#    ServerAlias www.s2mc-consulting.com
#    
#    DocumentRoot /var/www/s2mc-consulting/build
#    
#    SSLEngine on
#    SSLCertificateFile /etc/letsencrypt/live/s2mc-consulting.com/fullchain.pem
#    SSLCertificateKeyFile /etc/letsencrypt/live/s2mc-consulting.com/privkey.pem
#    Include /etc/letsencrypt/options-ssl-apache.conf
#    
#    # Même configuration que ci-dessus...
#</VirtualHost>
